<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Vars.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sprouts</a> &gt; <a href="index.source.html" class="el_package">sprouts</a> &gt; <span class="el_source">Vars.java</span></div><h1>Vars.java</h1><pre class="source lang-java linenums">package sprouts;

import org.jspecify.annotations.NonNull;
import org.jspecify.annotations.Nullable;
import sprouts.impl.Sprouts;

import java.util.Comparator;
import java.util.List;
import java.util.NoSuchElementException;
import java.util.Objects;
import java.util.function.Function;
import java.util.function.Predicate;

/**
 * A list of mutable properties that can be observed for changes by
 * {@link Subscriber} types (see {@link Observer} and {@link sprouts.Action}).
 * Contrary to the supertype {@link Vals}, this interface provides methods for mutating the list. &lt;br&gt;
 * If you want register change listeners to the list use {@link #view()} to create a weakly referenced
 * {@link Viewables} instance that can be observed for changes through {@link Viewables#onChange(Action)}. &lt;br&gt;
 * Use {@link Viewables#subscribe(Observer)} if you want to be notified of changes to the list
 * without any further information about the change itself. Note that this {@link Viewables}
 * will be garbage collected alongside all of its change listeners when no longer referenced.
 * &lt;p&gt;
 * The name of this class is short for &quot;variables&quot;. This name was deliberately chosen because
 * it is short, and yet clearly conveys the same meaning as other names used to model this
 * kind of pattern, like &quot;properties&quot;, &quot;observable objects&quot;, &quot;observable values&quot;, &quot;observable properties&quot;, etc.
 * &lt;p&gt;
 * &lt;b&gt;Please take a look at the &lt;a href=&quot;https://globaltcad.github.io/sprouts/&quot;&gt;living sprouts documentation&lt;/a&gt;
 * where you can browse a large collection of examples demonstrating how to use the API of this class.&lt;/b&gt;
 *
 * @param &lt;T&gt; The type of the properties.
 */
public interface Vars&lt;T extends @Nullable Object&gt; extends Vals&lt;T&gt; {

    /**
     * Creates a list of non-nullable properties from the supplied type and vararg values.
     * This factory method requires that the type be specified because the
     * compiler cannot infer the type from a potentially empty vararg array.
     *
     * @param type the type of the properties.
     * @param vars the properties to add to the new Vars instance.
     * @param &lt;T&gt;  the type of the properties.
     * @return a new {@code Vars} instance.
     * @throws NullPointerException     if {@code type} is {@code null}, or {@code vars} is {@code null}.
     * @throws IllegalArgumentException if any property allows {@code null}.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    static &lt;T&gt; Vars&lt;T&gt; of( Class&lt;T&gt; type, Var&lt;T&gt;... vars ) {
<span class="fc" id="L49">        Objects.requireNonNull(type);</span>
<span class="fc" id="L50">        Objects.requireNonNull(vars);</span>
<span class="fc" id="L51">        return Sprouts.factory().varsOf( type, vars );</span>
    }

    /**
     * Creates an empty list of non-nullable properties from the supplied type.
     * This factory method requires that the type be specified because the
     * compiler cannot infer the type from a potentially empty vararg array.
     *
     * @param type the type of the properties.
     *             This is used to check if the item is of the correct type.
     * @param &lt;T&gt;  the type of the properties.
     * @return a new {@code Vars} instance.
     * @throws NullPointerException if {@code type} is {@code null}.
     */
    static &lt;T&gt; Vars&lt;T&gt; of( Class&lt;T&gt; type ) {
<span class="fc" id="L66">        Objects.requireNonNull(type);</span>
<span class="fc" id="L67">        return Sprouts.factory().varsOf( type );</span>
    }

    /**
     * Creates a list of non-nullable properties from one or more non-nullable properties.
     *
     * @param first the first property to add to the new Vars instance.
     * @param rest  the remaining properties to add to the new Vars instance.
     * @param &lt;T&gt;   the type of the properties.
     * @return a new {@code Vars} instance.
     * @throws NullPointerException     if {@code first} is {@code null}, or {@code rest} is {@code null}.
     * @throws IllegalArgumentException if any property allows {@code null}.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    static &lt;T&gt; Vars&lt;T&gt; of( Var&lt;T&gt; first, Var&lt;T&gt;... rest ) {
<span class="fc" id="L82">        Objects.requireNonNull(first);</span>
<span class="fc" id="L83">        Objects.requireNonNull(rest);</span>
<span class="fc" id="L84">        return Sprouts.factory().varsOf( first, rest );</span>
    }

    /**
     * Creates a list of non-nullable properties from one or more non-null values.
     *
     * @param first the first value to add to the new Vars instance.
     * @param rest  the remaining values to add to the new Vars instance.
     * @param &lt;T&gt;   the type of the values.
     * @return a new {@code Vars} instance.
     * @throws NullPointerException     if {@code first} is {@code null}, or {@code rest} is {@code null}.
     * @throws IllegalArgumentException if any value in {@code rest} is {@code null}.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    static &lt;T&gt; Vars&lt;T&gt; of( T first, T... rest ) {
<span class="fc" id="L99">        Objects.requireNonNull(first);</span>
<span class="fc" id="L100">        Objects.requireNonNull(rest);</span>
<span class="fc" id="L101">        return Sprouts.factory().varsOf( first, rest );</span>
    }

    /**
     * Creates a list of non-nullable properties from the supplied type and values.
     * This factory method requires that the type be specified because the
     * compiler cannot infer the type from the values.
     *
     * @param type  the type of the properties.
     * @param items the values to be wrapped by properties and then added to the new Vars instance.
     *              The values may not be null.
     * @param &lt;T&gt;   the type of the values.
     * @return a new {@code Vars} instance.
     * @throws NullPointerException if {@code type} is {@code null}, or {@code items} is {@code null}.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    static &lt;T&gt; Vars&lt;T&gt; of( Class&lt;T&gt; type, T... items ) {
<span class="nc" id="L118">        Objects.requireNonNull(type);</span>
<span class="nc" id="L119">        Objects.requireNonNull(items);</span>
<span class="nc" id="L120">        return Sprouts.factory().varsOf( type, items );</span>
    }

    /**
     * Creates a list of non-nullable properties from the supplied type and iterable of values.
     * This factory method requires that the type be specified because the
     * compiler cannot infer the type from a potentially empty iterable.
     *
     * @param type the type of the properties.
     * @param vars the iterable of values.
     * @param &lt;T&gt;  the type of the properties.
     * @return a new {@code Vars} instance.
     * @throws NullPointerException     if {@code type} is {@code null}, or {@code vars} is {@code null}.
     * @throws IllegalArgumentException if any property in {@code vars} allows {@code null}.
     */
    static &lt;T&gt; Vars&lt;T&gt; of( Class&lt;T&gt; type, Iterable&lt;Var&lt;T&gt;&gt; vars ) {
<span class="fc" id="L136">        Objects.requireNonNull(type);</span>
<span class="fc" id="L137">        Objects.requireNonNull(vars);</span>
<span class="fc" id="L138">        return Sprouts.factory().varsOf( type, vars );</span>
    }

    /**
     * Creates a list of nullable properties from the supplied type and varargs properties.
     * This factory method requires that the type be specified because the
     * compiler cannot infer the type from the null values.
     *
     * @param type the type of the properties.
     * @param vars the properties to add to the new Vars instance.
     *             The properties may be nullable properties, but they may not be null themselves.
     * @param &lt;T&gt;  the type of the properties.
     * @return a new {@code Vars} instance.
     * @throws NullPointerException if {@code type} is {@code null}, or {@code vars} is {@code null}.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    static &lt;T&gt; Vars&lt;@Nullable T&gt; ofNullable( Class&lt;T&gt; type, Var&lt;@Nullable T&gt;... vars ) {
<span class="fc" id="L155">        Objects.requireNonNull(type);</span>
<span class="fc" id="L156">        Objects.requireNonNull(vars);</span>
<span class="nc" id="L157">        return Sprouts.factory().varsOfNullable( type, vars );</span>
    }

    /**
     * Creates an empty list of nullable properties from the supplied type.
     * This factory method requires that the type be specified because the
     * compiler cannot infer the type from a potentially empty vararg array.
     *
     * @param type the type of the properties.
     *             This is used to check if the item is of the correct type.
     * @param &lt;T&gt;  the type of the properties.
     * @return a new {@code Vars} instance.
     * @throws NullPointerException if {@code type} is {@code null}.
     */
    static &lt;T&gt; Vars&lt;@Nullable T&gt; ofNullable( Class&lt;T&gt; type ) {
<span class="fc" id="L172">        Objects.requireNonNull(type);</span>
<span class="fc" id="L173">        return Sprouts.factory().varsOfNullable( type );</span>
    }

    /**
     * Creates a list of nullable properties from the supplied type and values.
     * This factory method requires that the type be specified because the
     * compiler cannot infer the type from the null values.
     *
     * @param type   the type of the properties.
     * @param values the values to be wrapped by properties and then added to the new Vars instance.
     *               The values may be null.
     * @param &lt;T&gt;    the type of the values.
     * @return a new {@code Vars} instance.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    static &lt;T&gt; Vars&lt;@Nullable T&gt; ofNullable( Class&lt;T&gt; type, @Nullable T... values ) {
<span class="fc" id="L189">        Objects.requireNonNull(type);</span>
<span class="fc" id="L190">        return Sprouts.factory().varsOfNullable( type, values );</span>
    }

    /**
     * Creates a list of nullable properties from the supplied properties.
     *
     * @param first the first property to add to the new Vars instance.
     * @param rest  the remaining properties to add to the new Vars instance.
     * @param &lt;T&gt;   the type of the properties.
     * @return a new {@code Vars} instance.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    static &lt;T&gt; Vars&lt;@Nullable T&gt; ofNullable( Var&lt;@Nullable T&gt; first, Var&lt;@Nullable T&gt;... rest ) {
<span class="nc" id="L203">        Objects.requireNonNull(first);</span>
<span class="nc" id="L204">        Objects.requireNonNull(rest);</span>
<span class="nc" id="L205">        return Sprouts.factory().varsOfNullable( first, rest );</span>
    }

    /**
     * Creates a list of nullable properties from the supplied type and iterable of values.
     * This factory method requires that the type be specified because the
     * compiler cannot infer the type from a potentially empty iterable.
     *
     * @param type the type of the properties.
     * @param vars the iterable of values.
     * @param &lt;T&gt;  the type of the properties.
     * @return a new {@code Vars} instance.
     */
    static &lt;T&gt; Vars&lt;@Nullable T&gt; ofNullable( Class&lt;T&gt; type, Iterable&lt;Var&lt;@Nullable T&gt;&gt; vars ) {
<span class="fc" id="L219">        Objects.requireNonNull(type);</span>
<span class="fc" id="L220">        return Sprouts.factory().varsOfNullable( type, vars );</span>
    }

    /** {@inheritDoc} */
    @Override Var&lt;T&gt; at( int index );

    /** {@inheritDoc} */
    @Override
    default Var&lt;T&gt; first() {
<span class="pc bpc" id="L229" title="1 of 2 branches missed.">        if (isEmpty())</span>
<span class="nc" id="L230">            throw new NoSuchElementException(&quot;There is no such property in the list. The list is empty.&quot;);</span>
<span class="fc" id="L231">        return at(0);</span>
    }

    /** {@inheritDoc} */
    @Override
    default Var&lt;T&gt; last() {
<span class="pc bpc" id="L237" title="1 of 2 branches missed.">        if (isEmpty())</span>
<span class="nc" id="L238">            throw new NoSuchElementException(&quot;There is no such property in the list. The list is empty.&quot;);</span>
<span class="fc" id="L239">        return at(size() - 1);</span>
    }

    /**
     * Wraps the provided value in a {@link Var} property and adds it to the list.
     *
     * @param value The value to add.
     * @return {@code this} list of properties.
     * @throws NullPointerException if {@code null} is not allowed and the {@code value} is {@code null}.
     */
    default Vars&lt;T&gt; add( T value ) {
<span class="fc bfc" id="L250" title="All 2 branches covered.">        if (allowsNull())</span>
<span class="fc" id="L251">            return add(Var.ofNullable(type(), value));</span>
<span class="fc" id="L252">        Objects.requireNonNull(value);</span>
<span class="fc" id="L253">        return add(Var.of(value));</span>
    }

    /**
     * Adds the provided property to the end of the list.
     * Note that this may have unwanted side effects in case of the supplied property
     * having change listeners attached to it. &lt;br&gt;
     * Use {@link #add(Val)} to add the item of the property to the list
     * in the form of a new mutable {@link Var} property to avoid side effects.
     *
     * @param var the property to add.
     * @return {@code this} list of properties.
     * @throws IllegalArgumentException if the list allows {@code null} and the property does not allow {@code null}.
     * @throws NullPointerException     if the {@code var} is {@code null}.
     */
    default Vars&lt;T&gt; add( Var&lt;T&gt; var ) {
<span class="fc" id="L269">        Objects.requireNonNull(var);</span>
<span class="fc" id="L270">        return addAt( size(), var );</span>
    }

    /**
     * Wraps the item of the provided {@link Val} in a new mutable {@link Var} property
     * and adds it to the end of this property list. &lt;br&gt;
     * Use {@link #add(Var)} to add the property itself to the list.
     *
     * @param val The property whose item should be added to this property list.
     * @return {@code this} list of properties.
     * @throws NullPointerException if {@code null} is not allowed and the {@code val} is {@code null}.
     * @throws NullPointerException if the {@code val} is {@code null}.
     */
    default Vars&lt;T&gt; add( Val&lt;T&gt; val ) {
<span class="nc" id="L284">        Objects.requireNonNull(val);</span>
<span class="nc" id="L285">        return addAt( size(), val );</span>
    }

    /**
     * Removes the property at the specified index.
     *
     * @param index The index of the property to remove.
     * @return {@code this} list of properties.
     * @throws IndexOutOfBoundsException if {@code index} is negative, or {@code index} is greater than or equal to the
     *                                   size of this {@code Vars} object.
     */
    default Vars&lt;T&gt; removeAt( int index ) {
<span class="fc" id="L297">        return removeRange(index, index + 1);</span>
    }

    /**
     * Removes the sequence of properties at the specified index.
     *
     * @param index the index of the sequence to remove.
     * @param size  the size of the sequence to remove.
     * @return {@code this} list of properties.
     * @throws IndexOutOfBoundsException if {@code index} is negative, or {@code size} is negative,
     *                                   or {@code index} + {@code size} is greater than the size of this {@code Vars}
     *                                   object.
     */
    default Vars&lt;T&gt; removeAt( int index, int size ) {
<span class="fc" id="L311">        return removeRange(index, index + size);</span>
    }

    /**
     * Removes and returns the property at the specified index.
     *
     * @param index the index of the property to remove.
     * @return the removed property.
     * @throws IndexOutOfBoundsException if {@code index} is negative, or {@code index} is greater than or equal to the
     *                                   size of this {@code Vars} object.
     */
    default Var&lt;T&gt; popAt( int index ) {
<span class="fc" id="L323">        Var&lt;T&gt; var = at(index);</span>
<span class="fc" id="L324">        removeRange(index, index + 1);</span>
<span class="fc" id="L325">        return var;</span>
    }

    /**
     * Removes and returns the sequence of properties at the specified index.
     *
     * @param index the index of the sequence to pop.
     * @param size  the size of the sequence to pop.
     * @return The removed list of properties.
     * @throws IndexOutOfBoundsException if {@code index} is negative, or {@code size} is negative,
     *                                   or {@code index} + {@code size} is greater than the size of this {@code Vars}
     *                                   object.
     */
    default Vars&lt;T&gt; popAt( int index, int size ) {
<span class="fc" id="L339">        return popRange(index, index + size);</span>
    }

    /**
     * Remove and return all elements within the range {@code from} inclusive and {@code to} exclusive.
     *
     * @param from the start index, inclusive.
     * @param to   the end index, exclusive.
     * @return The removed list of properties.
     * @throws IndexOutOfBoundsException if {@code from} is negative, or {@code to} is greater than the size of this
     *                                   {@code Vars} object, or {@code from} is greater than {@code to}.
     */
    Vars&lt;T&gt; popRange(int from, int to);

    /**
     * Removes the property containing the provided value from the list.
     * If the value is not found, the list is unchanged.
     *
     * @param value the value to remove.
     * @return {@code this} list of properties.
     */
    default Vars&lt;T&gt; remove( T value ) {
<span class="fc" id="L361">        int index = indexOf(value);</span>
<span class="pc bpc" id="L362" title="1 of 2 branches missed.">        return index &lt; 0 ? this : removeRange( index, index + 1 );</span>
    }

    /**
     * Removes the property containing the provided value from the list.
     * If the value is not found, a {@link NoSuchElementException} is thrown.
     *
     * @param value the value to remove.
     * @return {@code this} list of properties.
     * @throws NoSuchElementException if the value is not found.
     */
    default Vars&lt;T&gt; removeOrThrow( T value ) {
<span class="fc" id="L374">        int index = indexOf(value);</span>
<span class="fc bfc" id="L375" title="All 2 branches covered.">        if ( index &lt; 0 )</span>
<span class="fc" id="L376">            throw new NoSuchElementException(&quot;No such element: &quot; + value);</span>
<span class="fc" id="L377">        return removeRange( index, index + 1 );</span>
    }

    /**
     * Removes the provided property from the list.
     * If the property is not found, the list is unchanged.
     *
     * @param var the property to remove.
     * @return {@code this} list of properties.
     * @throws NullPointerException if the {@code var} is {@code null}.
     */
    default Vars&lt;T&gt; remove( Var&lt;T&gt; var ) {
<span class="fc" id="L389">        Objects.requireNonNull(var);</span>
<span class="fc" id="L390">        int index = indexOf(var);</span>
<span class="fc bfc" id="L391" title="All 2 branches covered.">        return index &lt; 0 ? this : removeRange( index, index + 1 );</span>
    }

    /**
     * Removes the provided property from the list.
     * If the property is not found, a {@link NoSuchElementException} is thrown.
     *
     * @param var the property to remove.
     * @return {@code this} list of properties.
     * @throws NoSuchElementException if the property is not found.
     * @throws NullPointerException  if the {@code var} is {@code null}.
     */
    default Vars&lt;T&gt; removeOrThrow( Var&lt;T&gt; var ) {
<span class="fc" id="L404">        Objects.requireNonNull(var);</span>
<span class="fc" id="L405">        int index = indexOf(var);</span>
<span class="fc bfc" id="L406" title="All 2 branches covered.">        if ( index &lt; 0 )</span>
<span class="fc" id="L407">            throw new NoSuchElementException(&quot;No such element: &quot; + var);</span>
<span class="fc" id="L408">        return removeRange( index, index + 1 );</span>
    }

    /**
     * Removes the first property from the list, or does nothing if the list is empty.
     *
     * @return {@code this} list of properties.
     */
    default Vars&lt;T&gt; removeFirst() {
<span class="pc bpc" id="L417" title="1 of 2 branches missed.">        return size() &gt; 0 ? removeRange(0, 1) : this;</span>
    }

    /**
     * Removes the first property from the list and returns it.
     *
     * @return the removed property.
     * @throws NoSuchElementException if the list is empty.
     */
    default Var&lt;T&gt; popFirst() {
<span class="fc" id="L427">        Var&lt;T&gt; var = first();</span>
<span class="fc" id="L428">        removeRange(0, 1);</span>
<span class="fc" id="L429">        return var;</span>
    }

    /**
     * Removes the last property from the list, or does nothing if the list is empty.
     *
     * @return {@code this} list of properties.
     */
    default Vars&lt;T&gt; removeLast() {
<span class="pc bpc" id="L438" title="1 of 2 branches missed.">        return size() &gt; 0 ? removeRange(size() - 1, size()) : this;</span>
    }

    /**
     * Remove all elements within the range {@code from} inclusive and {@code to} exclusive.
     *
     * @param from the start index, inclusive.
     * @param to   the end index, exclusive.
     * @return {@code this} list of properties.
     * @throws IndexOutOfBoundsException if {@code from} is negative, or {@code to} is greater than the size of this
     *                                   {@code Vars} object, or {@code from} is greater than {@code to}.
     */
    Vars&lt;T&gt; removeRange(int from, int to);

    /**
     * Removes the last property from the list and returns it.
     *
     * @return the removed property.
     * @throws NoSuchElementException if the list is empty.
     */
    default Var&lt;T&gt; popLast() {
<span class="pc bpc" id="L459" title="1 of 2 branches missed.">        if (isEmpty())</span>
<span class="nc" id="L460">            throw new NoSuchElementException(&quot;There is no such property in the list. The list is empty.&quot;);</span>
<span class="fc" id="L461">        return popRange(size() - 1, size()).at(0);</span>
    }

    /**
     * Removes {@code count} number of properties from the end of the list.
     * If {@code count} is greater than the size of the list, only all available properties will be removed.
     *
     * @param count the number of properties to remove.
     * @return {@code this} list of properties.
     * @throws IndexOutOfBoundsException if {@code count} is negative, or {@code count} is greater than the size of
     *                                   this {@code Vars} object.
     */
    default Vars&lt;T&gt; removeLast( int count ) {
<span class="fc" id="L474">        return removeRange(size() - count, size());</span>
    }

    /**
     * Removes {@code count} number of properties from the end of the list and returns them in a new list.
     * If {@code count} is greater than the size of the list, only all available properties will be popped.
     *
     * @param count the number of properties to remove.
     * @return a new list of properties.
     * @throws IndexOutOfBoundsException if {@code count} is negative, or {@code count} is greater than the size of
     *                                   this {@code Vars} object.
     */
    default Vars&lt;T&gt; popLast( int count ) {
<span class="fc" id="L487">        return popRange(size() - count, size());</span>
    }

    /**
     * Removes the first {@code count} number of properties from the list.
     * If {@code count} is greater than the size of the list, only all available properties will be removed.
     *
     * @param count the number of properties to remove.
     * @return {@code this} list of properties.
     * @throws IndexOutOfBoundsException if {@code count} is negative, or {@code count} is greater than the size of
     *                                   this {@code Vars} object.
     */
    default Vars&lt;T&gt; removeFirst( int count ) {
<span class="fc" id="L500">        return removeRange(0, count);</span>
    }

    /**
     * Removes the first {@code count} number of properties from the list and returns them in a new list.
     * If {@code count} is greater than the size of the list, only all available properties will be popped.
     *
     * @param count the number of properties to remove.
     * @return a new list of properties.
     * @throws IndexOutOfBoundsException if {@code count} is negative, or {@code count} is greater than the size of
     *                                   this {@code Vars} object.
     */
    default Vars&lt;T&gt; popFirst( int count ) {
<span class="fc" id="L513">        return popRange(0, count);</span>
    }

    /**
     * Removes all properties from the list for which the provided predicate
     * returns true.
     *
     * @param predicate the predicate to test each property.
     * @return {@code this} list of properties.
     */
    default Vars&lt;T&gt; removeIf( Predicate&lt;Var&lt;T&gt;&gt; predicate ) {
<span class="pc bpc" id="L524" title="1 of 2 branches missed.">        Vars&lt;T&gt; vars = allowsNull() ? Vars.ofNullable(type()) : Vars.of(type());</span>
<span class="fc bfc" id="L525" title="All 2 branches covered.">        for ( int i = size() - 1; i &gt;= 0; i-- )</span>
<span class="fc bfc" id="L526" title="All 2 branches covered.">            if ( predicate.test(at(i)) )</span>
<span class="fc" id="L527">                vars.add(at(i));</span>

<span class="fc" id="L529">        this.removeAll(vars); // remove from this list at once and trigger events only once!</span>
<span class="fc" id="L530">        return this;</span>
    }

    /**
     * Removes all properties from the list for which the provided predicate
     * returns true and returns them in a new list.
     *
     * @param predicate the predicate to test each property.
     * @return a new list of properties.
     */
    default Vars&lt;T&gt; popIf( Predicate&lt;Var&lt;T&gt;&gt; predicate ) {
<span class="pc bpc" id="L541" title="1 of 2 branches missed.">        Vars&lt;T&gt; vars = allowsNull() ? Vars.ofNullable(type()) : Vars.of(type());</span>
<span class="fc bfc" id="L542" title="All 2 branches covered.">        for ( int i = size() - 1; i &gt;= 0; i-- )</span>
<span class="fc bfc" id="L543" title="All 2 branches covered.">            if ( predicate.test(at(i)) )</span>
<span class="fc" id="L544">                vars.add(at(i) );</span>

<span class="fc" id="L546">        this.removeAll(vars); // remove from this list at once and trigger events only once!</span>
<span class="fc" id="L547">        return vars.revert();</span>
    }

    /**
     * Removes all properties from the list for whose items the provided predicate
     * returns true.
     *
     * @param predicate the predicate to test each property item.
     * @return {@code this} list of properties.
     */
    default Vars&lt;T&gt; removeIfItem( Predicate&lt;T&gt; predicate ) {
<span class="pc bpc" id="L558" title="1 of 2 branches missed.">        Vars&lt;T&gt; vars = (Vars&lt;T&gt;) (allowsNull() ? Vars.ofNullable(type()) : Vars.of(type()));</span>
<span class="fc bfc" id="L559" title="All 2 branches covered.">        for ( int i = size() - 1; i &gt;= 0; i-- )</span>
<span class="fc bfc" id="L560" title="All 2 branches covered.">            if ( predicate.test(this.at(i).get()) )</span>
<span class="fc" id="L561">                vars.add(this.at(i));</span>

<span class="fc" id="L563">        this.removeAll(vars); // remove from this list at once and trigger events only once!</span>
<span class="fc" id="L564">        return this;</span>
    }

    /**
     * Removes all properties from the list for whose items the provided predicate
     * returns true and returns them in a new list.
     *
     * @param predicate the predicate to test each property item.
     * @return a new list of properties.
     */
    default Vars&lt;T&gt; popIfItem( Predicate&lt;T&gt; predicate ) {
<span class="pc bpc" id="L575" title="1 of 2 branches missed.">        Vars&lt;T&gt; vars = (Vars&lt;T&gt;) (allowsNull() ? Vars.ofNullable(type()) : Vars.of(type()));</span>
<span class="fc bfc" id="L576" title="All 2 branches covered.">        for ( int i = size() - 1; i &gt;= 0; i-- )</span>
<span class="fc bfc" id="L577" title="All 2 branches covered.">            if ( predicate.test(at(i).get()) )</span>
<span class="fc" id="L578">                vars.add(at(i));</span>

<span class="fc" id="L580">        this.removeAll(vars); // remove from this list at once and trigger events only once!</span>
<span class="fc" id="L581">        return vars.revert();</span>
    }

    /**
     * Removes all properties from the list that are contained in the provided
     * list of properties.
     *
     * @param properties the list of properties to remove.
     * @return {@code this} list of properties.
     */
    Vars&lt;T&gt; removeAll( Vals&lt;T&gt; properties );

    /**
     * Removes all properties from the list whose items are contained in the provided
     * array of properties and returns them in a new list.
     *
     * @param items the list of properties to remove.
     * @return {@code this} list of properties.
     */
    default Vars&lt;T&gt; removeAll( T... items ) {
<span class="fc" id="L601">        T @Nullable[] arrayOfThis = (T[]) new Object[size()];</span>
<span class="fc bfc" id="L602" title="All 2 branches covered.">        for ( int i = 0; i &lt; size(); i++ ) {</span>
<span class="fc" id="L603">            arrayOfThis[i] = at(i).orElseNull();</span>
        }
<span class="fc bfc" id="L605" title="All 2 branches covered.">        Vals&lt;T&gt; toBeRemoved = allowsNull() ? Vals.ofNullable(type(), items) : Vals.of(type(), items);</span>

<span class="fc" id="L607">        return removeAll(toBeRemoved);</span>
    }

    /**
     * Wraps the provided value in a {@link Var} property and adds it to the list
     * at the specified index.
     *
     * @param index the index at which to add the property.
     * @param item  the value to add as a property item.
     * @return {@code this} list of properties.
     * @throws NullPointerException if {@code null} is not allowed and the {@code item} is {@code null}.
     */
    default Vars&lt;T&gt; addAt( int index, T item ) {
<span class="pc bpc" id="L620" title="1 of 2 branches missed.">        if (allowsNull())</span>
<span class="nc" id="L621">            return addAt(index, Var.ofNullable(type(), item));</span>
<span class="fc" id="L622">        Objects.requireNonNull(item);</span>
<span class="fc" id="L623">        return addAt(index, Var.of(item));</span>
    }

    /**
     * Adds the provided property to the list at the specified index.
     * Note that this may have unwanted side effects in case of the supplied property
     * having change listeners attached to it.
     * Use {@link #addAt(int, Val)} to only add the item of the property
     * in the form of a new {@link Var} property to avoid side effects.
     *
     * @param index The index at which to add the property.
     * @param var   The property to add.
     * @return {@code this} list of properties.
     * @throws IllegalArgumentException if the list allows {@code null} and the property does not allow {@code null}.
     */
    Vars&lt;T&gt; addAt( int index, Var&lt;T&gt; var );

    /**
     * Wraps the item of the provided {@link Val} in a new {@link Var} property
     * and adds it to the list at the specified index.
     * This method is useful when you want to add the item of a property
     * to a list without side effects. &lt;br&gt;
     * If you want to add a complete property reference to
     * this list, use the {@link #addAt(int, Var)} method instead.
     *
     * @param index the index at which to add the property.
     * @param val   the value to add as a property item.
     * @return {@code this} list of properties.
     * @throws NullPointerException if {@code null} is not allowed and the supplied {@code val} is {@code null}.
     */
    default Vars&lt;T&gt; addAt( int index, Val&lt;T&gt; val ) {
<span class="fc" id="L654">        Objects.requireNonNull(val);</span>
<span class="pc bpc" id="L655" title="1 of 2 branches missed.">        if ( this.allowsNull() )</span>
<span class="nc" id="L656">            return addAt( index, Var.ofNullable(val.type(), val.orElseNull()) );</span>
<span class="fc bfc" id="L657" title="All 2 branches covered.">        else if ( val.isPresent() )</span>
<span class="fc" id="L658">            return addAt( index, Var.of(val.get()) );</span>
        else
<span class="fc" id="L660">            throw new IllegalArgumentException(</span>
                        &quot;Attempted to add an empty property (null) to a &quot; +
                        &quot;property list that does not allow null values.&quot;
                    );
    }

    /**
     * Wraps the provided value in a property and sets it at the specified index
     * effectively replacing the property at that index.
     *
     * @param index the index at which to set the property.
     * @param item  the value to set.
     * @return {@code this} list of properties.
     * @throws NullPointerException      if {@code null} is not allowed and the {@code item} is {@code null}.
     * @throws IndexOutOfBoundsException if {@code index} is negative, or {@code index} is greater than or equal to the
     *                                   size of this {@code Vars} object.
     */
    default Vars&lt;T&gt; setAt( int index, T item ) {
<span class="pc bpc" id="L678" title="1 of 2 branches missed.">        if (allowsNull())</span>
<span class="nc" id="L679">            return setAt(index, Var.ofNullable(type(), item));</span>
<span class="fc" id="L680">        Objects.requireNonNull(item);</span>
<span class="fc" id="L681">        return setAt(index, Var.of(item));</span>
    }

    /**
     * Wraps the specified value in distinct properties and sets them in the specified sequence, effectively replacing
     * the property at that sequence.
     *
     * @param index the index of the sequence to set the properties.
     * @param size  the size of the sequence to set the properties.
     * @param item  the value to set.
     * @return {@code this} list of properties.
     * @throws IndexOutOfBoundsException if {@code index} is negative, or {@code size} is negative,
     *                                   or {@code index} + {@code size} is greater than the size of
     *                                   this {@code Vars} object.
     * @throws NullPointerException      if {@code null} is not allowed and the {@code item} is {@code null}.
     */
    default Vars&lt;T&gt; setAt( int index, int size, T item ) {
<span class="fc" id="L698">        return setRange(index, index + size, item);</span>
    }

    /**
     * Places the provided property at the specified index, effectively replacing the property
     * at that index.
     *
     * @param index The index at which to set the property.
     * @param var   The property to set.
     * @return {@code this} list of properties.
     * @throws IndexOutOfBoundsException if {@code index} is negative, or {@code index} is greater than or equal to the
     *                                   size of this {@code Vars} object.
     * @throws IllegalArgumentException  if the list allows {@code null} and the property does not allow {@code null}.
     */
    Vars&lt;T&gt; setAt( int index, Var&lt;T&gt; var );

    /**
     * Wraps the item of the provided {@link Val} in a new {@link Var} property
     * and sets it at the specified index effectively replacing the property at that index.
     * This method is useful when you want to set the item of a property
     * in a list without side effects. &lt;br&gt;
     * If you want to replace the full property reference at a particular position in
     * this list, use the {@link #setAt(int, Var)} method instead.
     *
     * @param index The index at which to set the property.
     * @param val   The value to set as a property item.
     * @return {@code this} list of properties.
     * @throws NullPointerException if {@code null} is not allowed and the supplied {@code val} is {@code null}.
     */
    default Vars&lt;T&gt; setAt( int index, Val&lt;T&gt; val ) {
<span class="fc" id="L728">        Objects.requireNonNull(val);</span>
<span class="pc bpc" id="L729" title="1 of 2 branches missed.">        if ( this.allowsNull() )</span>
<span class="nc" id="L730">            return setAt( index, Var.ofNullable(val.type(), val.orElseNull()) );</span>
<span class="fc bfc" id="L731" title="All 2 branches covered.">        else if ( val.isPresent() )</span>
<span class="fc" id="L732">            return setAt( index, Var.of(val.get()) );</span>
        else
<span class="fc" id="L734">            throw new IllegalArgumentException(</span>
                        &quot;Attempted to add an empty property (null) to a &quot; +
                        &quot;property list that does not allow null values.&quot;
                    );
    }

    /**
     * Places the provided property in the specified sequence, effectively replacing the properties at the specified
     * sequence with the given property.
     * &lt;p&gt;
     * Note: The provided property will be placed in the provided sequence.
     * This will cause the same property to be placed multiple times in the list.
     *
     * @param index the index of the sequence to set the property.
     * @param size  the size of the sequence to set the property.
     * @param value the property to set.
     * @return {@code this} list of properties.
     * @throws IndexOutOfBoundsException if {@code index} is negative, or {@code size} is negative,
     *                                   or {@code index} + {@code size} is greater than the size of
     *                                   this {@code Vars} object.
     * @throws IllegalArgumentException  if the list allows {@code null} and the property does not allow {@code null}.
     */
    default Vars&lt;T&gt; setAt( int index, int size, Var&lt;T&gt; value ) {
<span class="fc" id="L757">        return setRange(index, index + size, value);</span>
    }

    /**
     * Wraps the specified value in distinct properties and sets them in the specified range,
     * effectively replacing the properties in the specified range.
     *
     * @param from  the start index, inclusive.
     * @param to    the end index, exclusive.
     * @param value the value to set.
     * @return {@code this} list of properties.
     * @throws IndexOutOfBoundsException if {@code from} is negative, or {@code to} is greater than the size of this
     *                                   {@code Vars} object, or {@code from} is greater than {@code to}.
     * @throws NullPointerException      if {@code null} is not allowed and the {@code item} is {@code null}.
     */
    Vars&lt;T&gt; setRange(int from, int to, T value);

    /**
     * Places the provided property in the specified range, effectively replacing the properties in the specified range
     * with the given property.
     * &lt;p&gt;
     * Note: The provided property will be placed in the provided range.
     * This will cause the same property to be placed multiple times in the list.
     *
     * @param from  the start index, inclusive.
     * @param to    the end index, exclusive.
     * @param value the value to set.
     * @return {@code this} list of properties.
     * @throws IndexOutOfBoundsException if {@code from} is negative, or {@code to} is greater than the size of this
     *                                   {@code Vars} object, or {@code from} is greater than {@code to}.
     * @throws IllegalArgumentException  if the list allows {@code null} and the property does not allow {@code null}.
     */
    Vars&lt;T&gt; setRange(int from, int to, Var&lt;T&gt; value);

    /**
     * Wraps each provided item in a property and appends it to this
     * list of properties.
     *
     * @param items The array of values to add as property items.
     * @return {@code this} list of properties.
     * @throws NullPointerException if {@code null} is not allowed and one of the {@code items} is {@code null}.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    default Vars&lt;T&gt; addAll( T... items ) {
<span class="fc bfc" id="L801" title="All 2 branches covered.">        Vars&lt;T&gt; vars = allowsNull() ? Vars.ofNullable(type()) : Vars.of(type());</span>
<span class="fc bfc" id="L802" title="All 2 branches covered.">        for ( T v : items ) vars.add(v);</span>
<span class="fc" id="L803">        return addAll(vars);</span>
    }

    /**
     * Iterates over the supplied values, and appends
     * them to {@code this} list as properties.
     *
     * @param items The values to add as property items.
     * @return {@code this} list of properties.
     * @throws NullPointerException if {@code null} is not allowed and one of the {@code items} is {@code null}.
     */
    default Vars&lt;T&gt; addAll( Iterable&lt;T&gt; items ) {
<span class="pc bpc" id="L815" title="1 of 2 branches missed.">        Vars&lt;T&gt; vars = (Vars&lt;T&gt;) (allowsNull() ? Vars.ofNullable(type()) : Vars.of(type()));</span>
<span class="fc bfc" id="L816" title="All 2 branches covered.">        for ( T v : items )</span>
<span class="fc" id="L817">            vars.add(v);</span>
<span class="fc" id="L818">        return addAll(vars);</span>
    }

    /**
     * Iterates over the supplied properties, and
     * adds their items to this list in the form of new
     * property instances.
     * This method deliberately adds copies instead of the properties
     * themselves due to the provided type being {@link Vals},
     * which implies a read only addition.
     * If you want to add the actual properties objects directly
     * (including all the listeners associated with the properties),
     * use {@link #addAll(Vars)}.
     *
     * @param vals The properties, whose items should be added to this list
     *             in the form of new {@link Var} properties.
     * @return {@code this} list of properties, to allow for method chaining.
     * @throws NullPointerException if the supplied property list is null.
     * @throws IllegalArgumentException if the list allows {@code null} and at least one
     *                                  property is empty (contains {@code null}).
     */
    default Vars&lt;T&gt; addAll( Vals&lt;T&gt; vals ) {
<span class="fc" id="L840">        Objects.requireNonNull(vals);</span>
<span class="pc bpc" id="L841" title="1 of 2 branches missed.">        Vars&lt;T&gt; cloned = allowsNull() ? Vars.ofNullable(type()) : Vars.of(type());</span>
<span class="fc bfc" id="L842" title="All 2 branches covered.">        for ( int i = 0; i &lt; vals.size(); i++ ) {</span>
<span class="fc" id="L843">            Val&lt;T&gt; toBeAdded = vals.at(i);</span>
<span class="pc bpc" id="L844" title="1 of 4 branches missed.">            if ( !this.allowsNull() &amp;&amp; toBeAdded.isEmpty() )</span>
<span class="fc" id="L845">                throw new IllegalArgumentException(&quot;Null items are not allowed in this property list.&quot;);</span>

<span class="fc" id="L847">            cloned.add(</span>
<span class="pc bpc" id="L848" title="1 of 2 branches missed.">                this.allowsNull() ?</span>
<span class="nc" id="L849">                    Var.ofNullable(toBeAdded.type(), toBeAdded.orElseNull()) :</span>
<span class="fc" id="L850">                    Var.of(toBeAdded.get())</span>
            );
        }
<span class="fc" id="L853">        return addAll(cloned);</span>
    }

    /**
     * Adds all properties from the provided list of properties to {@code this} list.
     * This method differs from {@link #addAll(Vals)} in that it adds the actual property objects
     * directly (including their listeners and possible side effects).
     * Use {@link #addAll(Vals)} if you want to add only the items of the properties.
     *
     * @param vars The list of properties to add.
     * @return {@code this} list of properties.
     * @throws IllegalArgumentException if the list allows {@code null} and at least one
     *                                  property does not allow {@code null}.
     */
    default Vars&lt;T&gt; addAll( Vars&lt;T&gt; vars ) {
<span class="fc" id="L868">        return addAllAt(size(), vars);</span>
    }

    /**
     * Wraps each provided item in a property and adds them
     * to this list of properties at the specified index.
     *
     * @param index The index at which to add the properties.
     * @param items The array of values to add as property items.
     * @return {@code this} list of properties.
     * @throws NullPointerException if {@code null} is not allowed and one of the {@code items} is {@code null}.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    default Vars&lt;T&gt; addAllAt( int index, T... items ) {
<span class="pc bpc" id="L882" title="1 of 2 branches missed.">        Vars&lt;T&gt; vars = allowsNull() ? Vars.ofNullable(type()) : Vars.of(type());</span>
<span class="fc bfc" id="L883" title="All 2 branches covered.">        for ( T v : items )</span>
<span class="fc" id="L884">            vars.add(v);</span>
<span class="fc" id="L885">        return addAllAt(index, vars);</span>
    }

    /**
     * Iterates over the supplied values, and adds
     * them to {@code this} list as properties at the specified index.
     *
     * @param index The index at which to add the properties.
     * @param items The values to add as property items.
     * @return {@code this} list of properties.
     * @throws NullPointerException if {@code null} is not allowed and one of the {@code items} is {@code null}.
     */
    default Vars&lt;T&gt; addAllAt( int index, Iterable&lt;T&gt; items ) {
<span class="nc bnc" id="L898" title="All 2 branches missed.">        Vars&lt;T&gt; vars = (Vars&lt;T&gt;) (allowsNull() ? Vars.ofNullable(type()) : Vars.of(type()));</span>
<span class="nc bnc" id="L899" title="All 2 branches missed.">        for ( T v : items )</span>
<span class="nc" id="L900">            vars.add(v);</span>
<span class="nc" id="L901">        return addAllAt(index, vars);</span>
    }

    /**
     * Iterates over the supplied properties, and
     * adds their items to this list in the form of new
     * property instances at the specified index.
     * This method deliberately adds copies instead of the properties
     * themselves due to the provided type being {@link Vals},
     * which implies a read only addition.
     * If you want to add the actual properties objects directly
     * (including all the listeners associated with the properties),
     * use {@link #addAllAt(int,Vars)}.
     *
     * @param index The index at which to add the properties.
     * @param vals The properties, whose items should be added to this list
     *             in the form of new {@link Var} properties.
     * @return {@code this} list of properties, to allow for method chaining.
     * @throws NullPointerException if the supplied property list is null.
     * @throws IllegalArgumentException if the list allows {@code null} and at least one
     *                                  property is empty (contains {@code null}).
     */
    default Vars&lt;T&gt; addAllAt( int index, Vals&lt;T&gt; vals ) {
<span class="fc" id="L924">        Objects.requireNonNull(vals);</span>
<span class="pc bpc" id="L925" title="1 of 2 branches missed.">        Vars&lt;T&gt; cloned = allowsNull() ? Vars.ofNullable(type()) : Vars.of(type());</span>
<span class="fc bfc" id="L926" title="All 2 branches covered.">        for ( int i = 0; i &lt; vals.size(); i++ ) {</span>
<span class="fc" id="L927">            Val&lt;T&gt; toBeAdded = vals.at(i);</span>
<span class="pc bpc" id="L928" title="2 of 4 branches missed.">            if ( !this.allowsNull() &amp;&amp; toBeAdded.isEmpty() )</span>
<span class="nc" id="L929">                throw new IllegalArgumentException(&quot;Null items are not allowed in this property list.&quot;);</span>

<span class="fc" id="L931">            cloned.add(</span>
<span class="pc bpc" id="L932" title="1 of 2 branches missed.">                this.allowsNull() ?</span>
<span class="nc" id="L933">                    Var.ofNullable(toBeAdded.type(), toBeAdded.orElseNull()) :</span>
<span class="fc" id="L934">                    Var.of(toBeAdded.get())</span>
            );
        }
<span class="fc" id="L937">        return addAllAt(index, cloned);</span>
    }

    /**
     * Adds all properties from the provided list of properties to {@code this} list
     * at a specified index.
     * This method differs from {@link #addAllAt(int,Vals)} in that it adds the actual property objects
     * directly (including their listeners and possible side effects).
     * Use {@link #addAllAt(int,Vals)} if you want to add only the items of the properties.
     *
     * @param index The index at which to add the properties.
     * @param vars The list of properties to add.
     * @return {@code this} list of properties.
     * @throws IllegalArgumentException if the list allows {@code null} and at least one
     *                                  property does not allow {@code null}.
     */
    Vars&lt;T&gt; addAllAt( int index, Vars&lt;T&gt; vars );

    /**
     * Wraps each provided item in a property and
     * overwrites the existing properties in this
     * property list, starting at the specified index.
     *
     * @param index The index at which to replace the current properties
     *              with new properties created from the array of items.
     * @param items The array of values to set as property items.
     * @return {@code this} list of properties.
     * @throws NullPointerException if {@code null} is not allowed and one of the {@code items} is {@code null}.
     * @throws IndexOutOfBoundsException if {@code index} is negative, or {@code index} is greater than or equal to the
     *                                  size of this {@code Vars} object.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    default Vars&lt;T&gt; setAllAt( int index, T... items ) {
<span class="pc bpc" id="L970" title="1 of 2 branches missed.">        Vars&lt;T&gt; vars = allowsNull() ? Vars.ofNullable(type()) : Vars.of(type());</span>
<span class="pc bpc" id="L971" title="1 of 2 branches missed.">        for ( T v : items )</span>
<span class="fc" id="L972">            vars.add(v);</span>
<span class="nc" id="L973">        return setAllAt(index, vars);</span>
    }

    /**
     * Iterates over the supplied values, and sets
     * them in this list as properties starting at the specified index.
     * This method will replace the properties in the specified range.
     *
     * @param index The index at which to set the properties.
     * @param items The values to set as property items.
     * @return {@code this} list of properties.
     * @throws NullPointerException if {@code null} is not allowed and one of the {@code items} is {@code null}.
     * @throws IndexOutOfBoundsException if {@code index} is negative, or {@code index} is greater than or equal to the
     *                                  size of this {@code Vars} object.
     */
    default Vars&lt;T&gt; setAllAt( int index, Iterable&lt;T&gt; items ) {
<span class="nc bnc" id="L989" title="All 2 branches missed.">        Vars&lt;T&gt; vars = (Vars&lt;T&gt;) (allowsNull() ? Vars.ofNullable(type()) : Vars.of(type()));</span>
<span class="nc bnc" id="L990" title="All 2 branches missed.">        for ( T v : items )</span>
<span class="nc" id="L991">            vars.add(v);</span>
<span class="nc" id="L992">        return setAllAt(index, vars);</span>
    }

    /**
     * Iterates over the supplied properties, and
     * sets their items in this list in the form of new
     * property instances starting at the specified index.
     * This method deliberately adds copies instead of the properties
     * themselves due to the provided type being {@link Vals},
     * which implies a read only addition.
     * If you want to set the actual properties objects directly
     * (including all the listeners associated with the properties),
     * use {@link #setAllAt(int,Vars)}.
     *
     * @param index The index at which to set the properties.
     * @param vals The properties, whose items should be set in this list
     *             in the form of new {@link Var} properties.
     * @return {@code this} list of properties, to allow for method chaining.
     * @throws NullPointerException if the supplied property list is null.
     * @throws IllegalArgumentException if the list allows {@code null} and at least one
     *                                  property is empty (contains {@code null}).
     */
    default Vars&lt;T&gt; setAllAt( int index, Vals&lt;T&gt; vals ) {
<span class="fc" id="L1015">        Objects.requireNonNull(vals);</span>
<span class="pc bpc" id="L1016" title="1 of 2 branches missed.">        Vars&lt;T&gt; cloned = allowsNull() ? Vars.ofNullable(type()) : Vars.of(type());</span>
<span class="fc bfc" id="L1017" title="All 2 branches covered.">        for ( int i = 0; i &lt; vals.size(); i++ ) {</span>
<span class="fc" id="L1018">            Val&lt;T&gt; toBeAdded = vals.at(i);</span>
<span class="pc bpc" id="L1019" title="2 of 4 branches missed.">            if ( !this.allowsNull() &amp;&amp; toBeAdded.isEmpty() )</span>
<span class="nc" id="L1020">                throw new IllegalArgumentException(&quot;Null items are not allowed in this property list.&quot;);</span>

<span class="fc" id="L1022">            cloned.add(</span>
<span class="pc bpc" id="L1023" title="1 of 2 branches missed.">                    this.allowsNull() ?</span>
<span class="nc" id="L1024">                            Var.ofNullable(toBeAdded.type(), toBeAdded.orElseNull()) :</span>
<span class="fc" id="L1025">                            Var.of(toBeAdded.get())</span>
            );
        }
<span class="fc" id="L1028">        return setAllAt(index, cloned);</span>
    }

    /**
     * Sets all properties from the provided list of properties to {@code this} list
     * at a specified index.
     * This method differs from {@link #setAllAt(int,Vals)} in that it sets the actual property objects
     * directly (including their listeners and possible side effects).
     * Use {@link #setAllAt(int,Vals)} if you want to set only the items of the properties.
     *
     * @param index The index at which to set the properties.
     * @param vars The list of properties to set.
     * @return {@code this} list of properties.
     * @throws IllegalArgumentException if the list allows {@code null} and at least one
     *                                  property does not allow {@code null}.
     */
    Vars&lt;T&gt; setAllAt( int index, Vars&lt;T&gt; vars );

    /**
     * Removes all properties from {@code this} list that are not contained in the provided list of properties.
     *
     * @param vars The list of properties to retain. All other properties will be removed.
     * @return {@code this} list of properties.
     */
    Vars&lt;T&gt; retainAll( Vals&lt;T&gt; vars );

    /**
     * Removes all properties from {@code this} list whose items are not contained in the provided array of items.
     *
     * @param items The array of items, whose properties to retain. All other properties will be removed.
     * @return {@code this} list of properties.
     */
    default Vars&lt;T&gt; retainAll( T... items ) {
<span class="pc bpc" id="L1061" title="1 of 2 branches missed.">        Vals&lt;T&gt; toBeRetained = allowsNull() ? Vals.ofNullable(type(), items) : Vals.of(type(), items);</span>
<span class="fc" id="L1062">        return retainAll(toBeRetained);</span>
    }

    /**
     * Removes all properties from {@code this} list.
     * This is conceptually equivalent to calling {@link List#clear()} on a regular list.
     *
     * @return {@code this} list.
     */
    Vars&lt;T&gt; clear();

    /**
     * Use this for mapping a list of properties to another list of properties.
     *
     * @return the new list.
     */
    @Override default Vars&lt;T&gt; map( Function&lt;T,T&gt; mapper ) {
<span class="fc" id="L1079">        Objects.requireNonNull(mapper);</span>
        @SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L1081">        Var&lt;T&gt;[] vars = new Var[size()];</span>
<span class="fc" id="L1082">        int i = 0;</span>
<span class="fc bfc" id="L1083" title="All 2 branches covered.">        for ( T v : this ) {</span>
<span class="fc" id="L1084">            T m = mapper.apply( v );</span>
<span class="pc bpc" id="L1085" title="1 of 2 branches missed.">            vars[i++] = allowsNull() ? Var.ofNullable( type(), m ) : Var.of( m );</span>
<span class="fc" id="L1086">        }</span>
<span class="fc" id="L1087">        return Vars.of( type(), vars );</span>
    }

    /**
     * Use this for mapping a list of properties to another list of properties.
     *
     * @return the new list.
     */
    @Override
    default &lt;U extends @Nullable Object&gt; Vars&lt;@Nullable U&gt; mapTo( Class&lt;@NonNull U&gt; type, Function&lt;@NonNull T,U&gt; mapper ) {
<span class="fc" id="L1097">        Objects.requireNonNull(type);</span>
<span class="fc" id="L1098">        Objects.requireNonNull(mapper);</span>
<span class="fc" id="L1099">        Vars&lt;@Nullable U&gt; vars = Vars.ofNullable(type);</span>
<span class="fc bfc" id="L1100" title="All 2 branches covered.">        for ( int i = 0; i &lt; size(); i++ )</span>
<span class="fc" id="L1101">            vars.add( at( i ).mapTo( type, mapper ) );</span>
<span class="fc" id="L1102">        return vars;</span>
    }

    /**
     * Create a copy of the current state of the list.
     * Note: The created {@code Vals} instance will not reflect changes made to the underlying list.
     *
     * @return an immutable copy of the current list.
     */
    default Vals&lt;T&gt; toVals() {
<span class="fc bfc" id="L1112" title="All 2 branches covered.">        return (Vals&lt;T&gt;) (allowsNull() ? Vals.ofNullable(type(), this) : Vals.of(type(), (Vals&lt;T&gt;) this));</span>
    }

    /**
     * Use this for sorting the list of properties.
     *
     * @param comparator The comparator to use for sorting.
     */
    void sort( Comparator&lt;T&gt; comparator );

    /**
     * Sorts the list of properties using the natural ordering of the properties.
     * Note that this method expected the wrapped values to be {@link Comparable}.
     *
     * @throws UnsupportedOperationException if the values are not {@link Comparable}.
     */
    default void sort() {
        // First we have to check if the type is comparable:
<span class="pc bpc" id="L1130" title="1 of 2 branches missed.">        if (Comparable.class.isAssignableFrom(type())) {</span>
            @SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L1132">            Comparator&lt;T&gt; comparator = (Comparator&lt;T&gt;) Comparator.naturalOrder();</span>
<span class="fc" id="L1133">            sort(comparator);</span>
<span class="fc" id="L1134">        } else {</span>
<span class="nc" id="L1135">            throw new UnsupportedOperationException(&quot;Cannot sort a list of non-comparable types.&quot;);</span>
        }
<span class="fc" id="L1137">    }</span>

    /**
     * Removes all duplicate properties from {@code this} list of properties.
     */
    void makeDistinct();

    /**
     * Reverse the order of the properties in {@code this} list.
     *
     * @return {@code this} list.
     */
    Vars&lt;T&gt; revert();
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>